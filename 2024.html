<!-- ================= 2024 Complete, confetti burst added and css card resize overide added for better card animation ================= -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>2024 Memories</title>

<link rel="stylesheet" href="styles.css">

<style>
/* ================= 2024 ONLY overrides ================= */
/* ================= BIRTHDAY diagonal yellow stripes BACKGROUND ================= */
body.birthday15-bg {
  background-color: #fff3b0;
  background-image: repeating-linear-gradient(
    45deg,
    #fff3b0 0px,
    #fff3b0 20px,
    #ffd966 20px,
    #ffd966 40px
  );
  background-attachment: fixed;
}

/* ================= BIRTHDAY dramatic heart patterned BACKGROUND ================= */
body.birthday8-bg {
  /*background-color: #ffe6f2; /* soft pastel base */
  background-color: #d883ac; /* soft pastel base */
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'><g fill-opacity='0.85'><path d='M10 30s-8-5-8-11a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 6-8 11-8 11z' fill='%23ff4d6a' transform='translate(20 20) rotate(-25) scale(1.5)'/><path d='M10 30s-8-5-8-11a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 6-8 11-8 11z' fill='%23ff99cc' transform='translate(80 50) rotate(10) scale(0.8)'/><path d='M10 30s-8-5-8-11a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 6-8 11-8 11z' fill='%239a5cff' transform='translate(50 100) rotate(-15) scale(2)'/><path d='M10 30s-8-5-8-11a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 6-8 11-8 11z' fill='%23ff8000' transform='translate(120 120) rotate(30) scale(1)'/><path d='M10 30s-8-5-8-11a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 6-8 11-8 11z' fill='%23ff66b2' transform='translate(30 140) rotate(-10) scale(0.6)'/><path d='M10 30s-8-5-8-11a5 5 0 0 1 8-3 5 5 0 0 1 8 3c0 6-8 11-8 11z' fill='%23cc33ff' transform='translate(100 20) rotate(5) scale(1.8)'/></g></svg>");
  background-repeat: repeat;
  background-size: 160px 160px;
  background-attachment: fixed;
  color: #7723bb; /* text contrast */
}

/* Birthday text contrast */
body.birthday8-bg h1,
body.birthday8-bg p {
  color: #7723bb;
}

/* ================= CHRISTMAS REALISTIC SNOWFLAKE BACKGROUND ================= */

body.christmas10-bg {
  background-color: #a8d0f0; /* soft winter blue */

  /* SVG tile: star-shaped snowflakes */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cg fill='white' fill-opacity='0.9'%3E%3Cpolygon points='10,2 12,7 17,7 13,11 15,16 10,13 5,16 7,11 3,7 8,7'/%3E%3Cpolygon points='50,40 52,45 57,45 53,49 55,54 50,51 45,54 47,49 43,45 48,45'/%3E%3Cpolygon points='120,30 122,35 127,35 123,39 125,44 120,41 115,44 117,39 113,35 118,35'/%3E%3Cpolygon points='80,80 82,85 87,85 83,89 85,94 80,91 75,94 77,89 73,85 78,85'/%3E%3Cpolygon points='30,60 32,65 37,65 33,69 35,74 30,71 25,74 27,69 23,65 28,65'/%3E%3Cpolygon points='150,120 152,125 157,125 153,129 155,134 150,131 145,134 147,129 143,125 148,125'/%3E%3Cpolygon points='70,40 72,45 77,45 73,49 75,54 70,51 65,54 67,49 63,45 68,45'/%3E%3Cpolygon points='110,100 112,105 117,105 113,109 115,114 110,111 105,114 107,109 103,105 108,105'/%3E%3Cpolygon points='50,140 52,145 57,145 53,149 55,154 50,151 45,154 47,149 43,145 48,145'/%3E%3Cpolygon points='140,70 142,75 147,75 143,79 145,84 140,81 135,84 137,79 133,75 138,75'/%3E%3C/g%3E%3C/svg%3E");

  background-repeat: repeat;
  background-size: 160px 160px;
  background-attachment: fixed;
}

/* Text contrast for light background */
body.christmas10-bg h1,
body.christmas10-bg p {
  color: #1b3f5c;
}

/* Birthday */
#cardPage .birthday-card-container{
  width: min(90vw, 420px);
  height: auto;                
  aspect-ratio: 1429 / 2000;   
}

/* Christmas */
#christmasCardPage .birthday-card-container{
  width: min(70vw, 300px);
  height: auto;                
  aspect-ratio: 1429 / 2000;
}

/* ================= MOBILE RESPONSIVENESS ================= */

/* Small screens general */
@media (max-width: 768px) {
  body {
    font-size: 14px;
  }

  h1 {
    font-size: 1.5rem;
  }

  .tiles {
    flex-direction: column;
    gap: 10px;
  }

  .tile {
    padding: 12px 8px;
    font-size: 1.2rem;
  }

  .back-btn, .logout-btn {
    font-size: 1rem;
    padding: 8px 12px;
  }
}

/* Mobile portrait */
@media (max-width: 768px) and (orientation: portrait) {
  #cardPage .birthday-card-container {
    width: 85vw;
  }
  #christmasCardPage .birthday-card-container {
    width: 75vw;
  }
}

/* Mobile landscape */
@media (max-width: 768px) and (orientation: landscape) {
  #cardPage .birthday-card-container {
    width: 60vw;
  }
  #christmasCardPage .birthday-card-container {
    width: 50vw;
  }

  .tiles {
    flex-direction: row;
    justify-content: space-around;
  }

  h1 {
    font-size: 1.3rem;
  }
}

/* Ensure photo modal fits mobile */
.photo-modal img#photoViewer {
  max-width: 95vw;
  max-height: 90vh;
  object-fit: contain;
}

/* ================= MOBILE RESPONSIVENESS ‚Äî 2024 CARD SCROLL ================= */

/* üì± Portrait */
@media (max-width:900px) and (orientation: portrait){

  /* Birthday + Christmas page layout */
  #cardPage, #christmasCardPage {
    display:flex;
    flex-direction: column;
    height: 100dvh; 
    overflow: hidden;
  }

  .card-header {
    flex: 0 0 auto;
    text-align: center;
    padding: 10px 0;
    z-index: 5;
  }

  .birthday-card-wrapper {
    flex: 1 1 auto;
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 20px;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
    padding: 0 20px;
    box-sizing: border-box;
  }

  .birthday-card-wrapper::before,
  .birthday-card-wrapper::after {
    content: "";
    flex: 0 0 calc((100vw - 5px)/2);
  }

  .birthday-card-container {
    flex: 0 0 auto;
    width: 220px;
    height: 390px;
    scroll-snap-align: center;
  }
}

/* üì± Landscape */
@media (max-width:900px) and (orientation: landscape){
  #cardPage, #christmasCardPage {
    display:flex;
    flex-direction: column;
    height: 100dvh;
    overflow-y: auto; /* scroll vertically to prevent clipping */
    overflow-x: hidden;
    padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
    box-sizing: border-box;
  }

  .card-header {
    flex: 0 0 auto;
    padding: 6px 0;
    text-align: center;
  }

  .birthday-card-wrapper {
    flex: 1 1 auto;
    display: flex;
    align-items: flex-start; /* align top to prevent clipping */
    gap: 14px;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
    padding: 10px 12px 10px 12px;
  }

  .birthday-card-wrapper::before,
  .birthday-card-wrapper::after {
    content: "";
    flex: 0 0 calc((100vw - 170px)/2);
  }

  .birthday-card-container {
    flex: 0 0 auto;
    width: 170px;
    aspect-ratio: 360/640;
    scroll-snap-align: center;
  }
}

/* ================= 2024 MOBILE CARD SIZE TWEAKS ================= */

/* Mobile portrait */
@media (max-width: 768px) and (orientation: portrait) {
  #cardPage .birthday-card-container {
    width: 60vw;  /* reduced from 85vw */
  }
  #christmasCardPage .birthday-card-container {
    width: 55vw;  /* reduced from 75vw */
  }
}

/* Mobile landscape */
@media (max-width: 768px) and (orientation: landscape) {
  #cardPage .birthday-card-container {
    width: 23vw;  /* reduced from 60vw */
  }
  #christmasCardPage .birthday-card-container {
    width: 25vw;  /* reduced from 50vw */
  }
}

</style>


</head>

<body class="birthday15-bg">

<!-- ================= AUDIO ================= -->
<audio id="birthdayAudio" src="Images/birthday.mp3" loop></audio>
<audio id="christmasAudio" src="Images/christmas.mp3" loop></audio>


<!-- ================= EFFECT LAYERS ================= -->
<div id="snow" class="effect-layer"></div>
<div id="balloonsB" class="effect-layer"></div>



<!-- ================= HOME ================= -->
<div class="card page" id="home" style="display:block;">
  <h1>2024</h1>
  <p>Select an event:</p>
  <button class="logout-btn" onclick="logout()">Logout</button>

  <div class="tiles">
    <div class="tile" onclick="openBirthday()">üéÇ Birthday</div>
    <div class="tile" onclick="openChristmas()">üéÑ Christmas</div>
  </div>

  <button class="back-btn" onclick="goDashboard()">Back</button>
</div>



<!-- ================= BIRTHDAY ================= -->
<div class="card page" id="cardPage" style="display:none;">
  <div class="card-header">
    <h1>2024 Birthday üéÇ</h1>
    <button class="back-btn" onclick="goHome()">Back</button>
  </div>

  <!-- ‚≠ê Scrollable wrapper for mobile -->
  <div class="birthday-card-wrapper">
    <div class="birthday-card-container">
      <div class="card-inner2">
        <img src="Images/Birthday_2024_3.png" class="card-photo">
      </div>

      <div class="card-flip" id="cardFlip">
        <div class="card-front">
          <img src="Images/Birthday_2024_1.png" class="card-photo">
        </div>

        <div class="card-inner1">
          <img src="Images/Birthday_2024_2.png" class="card-photo">
        </div>
      </div>
    </div>
  </div>
</div>



<!-- ================= CHRISTMAS ================= -->
<div class="card page" id="christmasCardPage" style="display:none;">
  <div class="card-header">
    <h1>2024 Christmas üéÑ</h1>
    <button class="back-btn" onclick="goHome()">Back</button>
  </div>

  <!-- Scrollable wrapper for mobile -->
  <div class="birthday-card-wrapper">
    <div class="birthday-card-container">
      <div class="card-inner2">
        <img src="Images/Christmas_2024_3.png" class="card-photo">
      </div>

      <div class="card-flip" id="christmasCardFlip">
        <div class="card-front">
          <img src="Images/Christmas_2024_1.png" class="card-photo">
        </div>

        <div class="card-inner1">
          <img src="Images/Christmas_2024_2.png" class="card-photo">
        </div>
      </div>
    </div>
  </div>
</div>

<div id="confetti" class="effect-layer"></div>

<!-- ================= PHOTO MODAL (same as 2022) ================= -->
<div class="photo-modal" id="photoModal">
  <span class="photo-close" onclick="closePhoto()">‚úï</span>
  <button class="nav prev" onclick="prevPhoto()">‚ùÆ</button>
  <img id="photoViewer">
  <button class="nav next" onclick="nextPhoto()">‚ùØ</button>
</div>

<script src="auth.js"></script>

<script>

/* =====================================================
   GLOBAL
===================================================== */

const snow = document.getElementById("snow");
const balloonsB = document.getElementById("balloonsB");
const confetti=document.getElementById("confetti");

const bdayAudio = document.getElementById("birthdayAudio");
const xmasAudio = document.getElementById("christmasAudio");

let balloonInterval = null;
let snowInterval = null;



/* =====================================================
   PAGE CONTROL
===================================================== */

function hideAll(){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  stopEffects();
}

function goHome(){
  hideAll();
  document.body.classList.remove("birthday8-bg", "christmas10-bg");
  document.body.classList.add("birthday15-bg"); // default home bg
  document.getElementById("home").style.display="block";
}

function goDashboard(){
  window.location.href = "index.html";
}

function logout(){
  sessionStorage.clear();
  localStorage.clear();
  window.location.replace("login.html");
}

/* =====================================================
   OPEN SECTIONS
===================================================== */

function openBirthday(){
  hideAll();

  document.body.classList.remove("birthday15-bg", "christmas10-bg");
  document.body.classList.add("birthday8-bg");

  document.getElementById("cardPage").style.display="block";

  bdayAudio.play();
  //startBalloons();
  startConfettiBurst();
  flipCard2023();
}

function openChristmas(){
  hideAll();

  document.body.classList.remove("birthday15-bg", "birthday8-bg");
  document.body.classList.add("christmas10-bg");

  document.getElementById("christmasCardPage").style.display="block";

  xmasAudio.play();
  startSnow();
  flipChristmasCard();
}



/* =====================================================
   STOP EVERYTHING WHEN LEAVING PAGE  ‚≠ê
===================================================== */

function stopEffects(){

  /* balloons */
  /*if(balloonInterval){
    clearInterval(balloonInterval);
    balloonInterval = null;
  }*/
  confetti.innerHTML="";
  confetti.style.display="none";

  /* snow */
  if(snowInterval){
    clearInterval(snowInterval);
    snowInterval = null;
  }
  snow.innerHTML="";
  snow.style.display="none";

  /* audio */
  bdayAudio.pause();
  xmasAudio.pause();
  bdayAudio.currentTime=0;
  xmasAudio.currentTime=0;

}

/* =====================================================
   BALLOONS (same as your 2023 main)
===================================================== */

function startBalloons(){

  balloonsB.style.display="block";

  const colors=[
    "#ff6b6b","#fbbf24","#34d399","#60a5fa","#a78bfa","#f472b6"
  ];

  balloonInterval=setInterval(()=>{

    const b=document.createElement("div");
    b.className="balloonB";

    b.style.left=Math.random()*100+"vw";
    b.style.bottom="-40px";
    b.style.background=colors[Math.floor(Math.random()*colors.length)];

    const duration=5+Math.random()*3;
    b.style.animationDuration=duration+"s";

    balloonsB.appendChild(b);

    setTimeout(()=>b.remove(),duration*1000);

  },300);
}

function startConfettiBurst(){
  confetti.style.display = "block";

  const burstCount = 350;

  for(let i=0;i<burstCount;i++){
    const c=document.createElement("div");

    c.style.position="absolute";
    c.style.width="8px";
    c.style.height="8px";
    c.style.background=`hsl(${Math.random()*360},80%,60%)`;

    c.style.left = 45 + Math.random()*10 + "vw";
    c.style.top = "40vh";

    const angle = Math.random()*360;
    const distance = 40 + Math.random()*60;

    const duration = 1400 + Math.random()*400;

    const anim = c.animate([
      { transform: "translate(0,0)", opacity: 1 },
      {
        transform: `translate(${Math.cos(angle*Math.PI/180)*distance}vw,
                              ${Math.sin(angle*Math.PI/180)*distance}vh)
                    rotate(720deg)`,
        opacity: 0
      }
    ],{
      duration: duration,
      easing: "ease-out"
    });

    // ‚≠ê REMOVE AFTER FINISHED
    anim.onfinish = () => c.remove();

    confetti.appendChild(c);
  }
}


/* =====================================================
   SNOW (same as your Christmas)
===================================================== */

function startSnow(){

  snow.style.display="block";

  snowInterval=setInterval(()=>{

    const s=document.createElement("div");
    s.innerHTML="‚ùÑ";
    s.style.position="absolute";
    s.style.left=Math.random()*100+"vw";
    s.style.animation="fallSnow 5s linear forwards";

    snow.appendChild(s);

    setTimeout(()=>s.remove(),5000);

  },150);
}



/* =====================================================
   RESPONSIVE CARD FLIP FUNCTIONS
===================================================== */

/* Birthday Card Flip */
function flipCard2023() {
  const container = document.getElementById("cardPage");
  const cardFlip = container.querySelector(".card-flip");
  const cardFront = container.querySelector(".card-front");
  const cardInner1 = container.querySelector(".card-inner1");
  const cardInner2 = container.querySelector(".card-inner2");

  // Reset
  cardFlip.style.transition = "none";
  cardFlip.style.transform = "rotateY(0deg)";
  [cardFront, cardInner1, cardInner2].forEach(c => {
    c.classList.remove("card-horizontal");
    c.style.transform = "";
  });

  // Flip animation
  setTimeout(() => {
    cardFlip.style.transition = "transform 0.8s ease-out";
    cardFlip.style.transform = "rotateY(-90deg)";
  }, 300);

  setTimeout(() => {
    cardFlip.style.transition = "transform 0.8s ease-in";
    cardFlip.style.transform = "rotateY(-180deg)";
  }, 1200);

  // Horizontal spread after flip
  setTimeout(() => {
    cardFlip.style.transition = "none";
    cardFlip.style.transform = "none";
    [cardFront, cardInner1, cardInner2].forEach(c => c.classList.add("card-horizontal"));

    // ‚úÖ Adjust spread based on orientation
    let spread;
    if(window.innerWidth <= 900){

      if(window.matchMedia("(orientation: landscape)").matches){
        spread = container.clientWidth * 0.28; // tighter for landscape
      }else{
        spread = container.clientWidth * 0.55; // portrait
      }

    }else{
      spread = container.clientWidth * 0.4; // desktop
    }


    cardFront.style.transform = `translateX(-${spread}px)`;
    cardInner1.style.transform = `translateX(0px)`;
    cardInner2.style.transform = `translateX(${spread}px)`;
  }, 2000);
}

/* ================= CHRISTMAS FUNCTIONS ================= */

/* ================= CHRISTMAS CARD FLIP ================= */
/* Christmas Card Flip */
function flipChristmasCard() {
  const container = document.getElementById("christmasCardPage");
  const cardFlip = container.querySelector(".card-flip");
  const cardFront = container.querySelector(".card-front");
  const cardInner1 = container.querySelector(".card-inner1");
  const cardInner2 = container.querySelector(".card-inner2");

  // Reset
  cardFlip.style.transition = "none";
  cardFlip.style.transform = "rotateY(0deg)";
  [cardFront, cardInner1, cardInner2].forEach(c => {
    c.classList.remove("card-horizontal");
    c.style.transform = "";
  });

  // Flip animation
  setTimeout(() => {
    cardFlip.style.transition = "transform 0.8s ease-out";
    cardFlip.style.transform = "rotateY(-90deg)";
  }, 300);

  setTimeout(() => {
    cardFlip.style.transition = "transform 0.8s ease-in";
    cardFlip.style.transform = "rotateY(-180deg)";
  }, 1200);

  // Horizontal spread after flip
  setTimeout(() => {
    cardFlip.style.transition = "none";
    cardFlip.style.transform = "none";
    [cardFront, cardInner1, cardInner2].forEach(c => c.classList.add("card-horizontal"));

    //const spread = container.clientWidth * 0.35; // 35% of container width for narrower Xmas card

    // ‚úÖ Adjust spread based on orientation
    let spread;
    if(window.innerWidth <= 900){

      if(window.matchMedia("(orientation: landscape)").matches){
        spread = container.clientWidth * 0.28; // tighter for landscape
      }else{
        spread = container.clientWidth * 0.55; // portrait
      }

    }else{
      spread = container.clientWidth * 0.4; // desktop
    }

    cardFront.style.transform = `translateX(-${spread}px)`;
    cardInner1.style.transform = `translateX(0px)`;
    cardInner2.style.transform = `translateX(${spread}px)`;
  }, 2000);
}


/* =====================================================
   PHOTO VIEWER (shared like 2022)
===================================================== */

const photoModal = document.getElementById("photoModal");
const photoViewer = document.getElementById("photoViewer");

let photos = [];
let photoIndex = 0;

/* open from any card-photo automatically */
document.addEventListener("click", e => {

  const img = e.target.closest(".card-photo");
  if(!img) return;

  /* only trigger inside card pages */
  if(!img.closest("#cardPage, #christmasCardPage")) return;

  photos = Array.from(
    img.closest(".birthday-card-container").querySelectorAll(".card-photo")
  );

  photoIndex = photos.indexOf(img);

  showPhoto(photoIndex);
  photoModal.style.display = "flex";
});

function showPhoto(i){
  photoViewer.src = photos[i].src;
}

function closePhoto(){
  photoModal.style.display = "none";
}

function nextPhoto(){
  photoIndex = (photoIndex + 1) % photos.length;
  showPhoto(photoIndex);
}

function prevPhoto(){
  photoIndex = (photoIndex - 1 + photos.length) % photos.length;
  showPhoto(photoIndex);
}

/* swipe support */
let startX = 0;

photoModal.addEventListener("touchstart", e=>{
  startX = e.touches[0].clientX;
});

photoModal.addEventListener("touchend", e=>{
  const diff = e.changedTouches[0].clientX - startX;
  if(Math.abs(diff) < 40) return;
  diff < 0 ? nextPhoto() : prevPhoto();
});

</script>
</body>
</html>
