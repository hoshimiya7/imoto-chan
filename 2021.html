<!-- ================= 2021 isolated from index - working optimised + responsive working for desktop and mobile portrait, landscape partially as huge gaps ================= -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>2021 Memories</title>

<link rel="stylesheet" href="styles.css">

<!-- =========================================================
     ‚úÖ 2021 ONLY RESPONSIVE CSS (SAFE ‚Äî won't affect others)
========================================================= -->
<style>

/* limit page width nicely on desktop */
#home,
#cardPage,
#christmasCardPage{
  width:min(95vw,900px);
  margin:auto;
}

/* responsive headings */
#home h1,
#cardPage h1,
#christmasCardPage h1{
  font-size:clamp(22px,4vw,40px);
}

/* responsive tiles */
#home .tiles{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:14px;
  width:100%;
}

/* buttons stack better on mobile */
/*.logout-btn,
.back-btn{
  width:min(100%,260px);
}*/

/* flower scales with screen */
#flower2021{
  width:min(90vw,500px);
  height:min(90vw,500px);
  margin:auto;
}

/* petals scale */
#flower2021 .flower-petal{
  width:clamp(45px,10vw,85px);
  position:absolute;
}

/* christmas image responsive */
.xmas-image-wrap img{
  width:100%;
  height:auto;
  max-height:65vh;
  object-fit:contain;
}

/* modal safe */
.photo-modal img{
  max-width:95vw;
  max-height:85vh;
}

/* =========================================
   2021 flower ‚Äì improved sizing + landscape fix
========================================= */

/* container */
#flower2021{
  width: min(88vw, 560px);
  aspect-ratio: 1;
  position: relative;
  margin: 2rem auto;
}

/* ‚≠ê BIGGER petals */
#flower2021 .flower-petal{
  width: clamp(85px, 16vw, 165px);
  height: clamp(85px, 16vw, 165px);
  border-radius: 50%;
  object-fit: cover;
}

/* centre scales nicely */
#flower2021 .flower-center{
  width: clamp(130px, 32vw, 230px);
  height: clamp(130px, 32vw, 230px);

  font-size: clamp(12px, 2.7vw, 18px);
  padding: clamp(8px, 2vw, 18px);

  z-index: 5;
}

/* ‚≠ê LANDSCAPE SPECIAL FIX */
/* =========================================
   MOBILE LANDSCAPE ‚Äì Birthday flower slightly bigger
========================================= */
@media (max-height:500px) and (orientation:landscape){

  /* increase flower size */
  #flower2021{
    width: 70vh; /* was 60vh */
    height: 70vh; /* match width for square container */
  }

  /* petals bigger and closer to center */
  #flower2021 .flower-petal{
    width: 14.5vh; /* was 13vh */
    height: 14.5vh;
  }

  /* center card slightly bigger to fill flower nicely */
  #flower2021 .flower-center{
    width: 30vh; /* was 28vh */
    height: 30vh;
  }

  /* maintain spacing for birthday page layout */
  #cardPage {
    padding: 0.5rem 1rem;
    margin: 0 auto;
  }

  #cardPage h1,
  #cardPage p {
    margin: 0.25rem 0;
    text-align: center;
  }

  #flower2021 {
    margin: 0.5rem auto;
  }

  #cardPage .back-btn {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
}

/* ================= MOBILE LANDSCAPE SCROLL FIX ================= */
@media (max-height:500px) and (orientation:landscape){

  /* allow pages to scroll naturally */
  .page {
    height: auto !important;
    min-height: 100vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* smooth scroll on iOS */
  }

  /* avoid huge vertical margins pushing title off-screen */
  #cardPage,
  #christmasCardPage {
    padding-top: 1rem; /* small top padding */
    padding-bottom: 1rem;
    margin-top: 0;
    margin-bottom: 0;
  }

  /* shrink flower slightly if needed to fit screen */
  #flower2021{
    max-height: 80vh; /* prevent overflowing viewport */
  }

  /* keep back button and spacing reasonable */
  #cardPage .back-btn {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
}

/* ================= MOBILE LANDSCAPE ‚Äì smart flower sizing ================= */
@media (max-height:500px) and (orientation:landscape) {

  /* allow page to scroll if content overflows */
  .page {
    height: auto !important;
    min-height: 100vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* smooth scroll on iOS */
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* card page spacing */
  #cardPage,
  #christmasCardPage {
    padding: 0.5rem 1rem;
    margin: 0;
    justify-content: flex-start; /* start from top */
  }

  /* flower container ‚Äì scale to fit remaining viewport */
  #flower2021 {
    width: auto;
    height: calc(100vh - 4rem); /* subtract space for title & back button */
    max-width: 80vw;           /* don't overflow horizontally */
    max-height: calc(100vh - 4rem);
    margin: 1rem auto;         /* keep top/bottom spacing */
  }

  /* petals scale relative to flower */
  #flower2021 .flower-petal{
    width: calc(18%);   /* scale with container width */
    height: calc(18%);
  }

  /* center card scales nicely */
  #flower2021 .flower-center{
    width: 25%;
    height: 25%;
    font-size: 1rem;
    padding: 0.5rem;
  }

  /* title and text always visible */
  #cardPage h1,
  #cardPage p,
  #christmasCardPage h1,
  #christmasCardPage p {
    margin: 0.25rem 0;
    text-align: center;
  }

  /* back button reasonable spacing */
  #cardPage .back-btn,
  #christmasCardPage .back-btn {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
}

</style>
</head>

<body>

<!-- ================= AUDIO ================= -->
<audio id="birthdayAudio" src="Images/birthday.mp3" loop></audio>
<audio id="christmasAudio" src="Images/christmas.mp3" loop></audio>


<!-- ================= EFFECT LAYERS ================= -->
<div id="snow" class="effect-layer"></div>
<div id="confetti" class="effect-layer"></div>



<!-- ================= HOME ================= -->
<div class="card page" id="home" style="display:block;">
  <h1>2021</h1>
  <p>Select an event:</p>
  <button class="logout-btn" onclick="logout()">Logout</button>

  <div class="tiles">
    <div class="tile" onclick="openBirthday()">üéÇ Birthday</div>
    <div class="tile" onclick="openChristmas()">üéÑ Christmas</div>
  </div>

  <button class="back-btn" onclick="goDashboard()">Back</button>
</div>



<!-- ================= BIRTHDAY ================= -->

<div class="card page" id="cardPage">
  <h1>2021 Birthday üéÇ</h1>
  <p>Celebration and memories of 2021.</p>
  <div class="flower-container" id="flower2021">
    <div class="flower-center">
        <div class="jp">„ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜÂ¶π</div>
        <div class="romaji">Otanj≈çbi omedet≈ç im≈çto-chan</div>
        <div class="en">Hope you have the greatest B-day ever! ‚ú®</div>
    </div>
    <img src="Images/petal1.png" class="flower-petal" />
    <img src="Images/petal2.png" class="flower-petal" />
    <img src="Images/petal3.png" class="flower-petal" />
    <img src="Images/petal4.png" class="flower-petal" />
    <img src="Images/petal5.png" class="flower-petal" />
    <img src="Images/petal6.png" class="flower-petal" />
  </div>
  <button class="back-btn" onclick="goHome()">Back</button>
</div>



<!-- ================= CHRISTMAS ================= -->

<div class="card page" id="christmasCardPage">
  <h1>2021 Christmas üéÑ</h1>

  <div class="xmas-photo-card">

    <div class="xmas-image-wrap">
      <img
        src="Images/christmas2021.jpg"
        alt="Christmas 2021 memory"
        class="xmas-clickable"
      >
      <div class="snow-local" id="snowLocal2021"></div>
    </div>

    <p class="xmas-caption">
      Our first Christmas together in 2021 ‚ùÑÔ∏è<br>
      Warm lights, happy hearts, and beautiful memories ‚ù§Ô∏è
    </p>

  </div>

  <button class="back-btn" onclick="goHome()">Back</button>
</div>

<!-- ================= PHOTO MODAL (same as 2022) ================= -->
<!-- Photo Modal -->
<div id="photoModal" class="photo-modal">
  <span class="photo-close">&times;</span>

  <button class="nav prev">&#10094;</button>
  <img id="photoPreview">
  <button class="nav next">&#10095;</button>
</div>

<!--<script src="auth.js"></script>-->

<script>

/* =====================================================
   GLOBAL
===================================================== */

const snow = document.getElementById("snow");
const confetti=document.getElementById("confetti");

const bdayAudio = document.getElementById("birthdayAudio");
const xmasAudio = document.getElementById("christmasAudio");

let snowInterval = null;



/* =====================================================
   PAGE CONTROL
===================================================== */

function hideAll(){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  stopEffects();
}

function goHome(){
  hideAll();
  document.body.classList.remove("christmas-bg");
  document.getElementById("home").style.display="block";
}

function goDashboard(){
  window.location.href = "index.html";
}

function positionPetals(containerId) {
  const container = document.getElementById(containerId);
  const petals = container.querySelectorAll(".flower-petal");

  const centerX = container.clientWidth / 2;
  const centerY = container.clientHeight / 2;

  //const radius = 190;
  const radius = Math.min(container.clientWidth, container.clientHeight) * 0.46;
  const centerSize = container.querySelector(".flower-center").clientWidth;
  const safeGap = centerSize/2 + petals[0].clientWidth/2 + 10;

  const finalRadius = Math.max(radius, safeGap);

  const petalCount = petals.length;

  let angleOffset = 0;

  function animate() {
    angleOffset += 0.003; // speed

    petals.forEach((petal, i) => {
      const angle = (2 * Math.PI / petalCount) * i + angleOffset;

      const x = centerX + finalRadius * Math.cos(angle) - petal.clientWidth / 2;
      const y = centerY + radius * Math.sin(angle) - petal.clientHeight / 2;

      // ONLY move ‚Äî no rotation
      petal.style.left = `${x}px`;
      petal.style.top = `${y}px`;
    });

    requestAnimationFrame(animate);
  }

  animate();
}

/* =====================================================
   OPEN SECTIONS
===================================================== */

function openBirthday(){
  hideAll();

  document.getElementById("cardPage").style.display="block";

  bdayAudio.play();
  startConfetti();
  positionPetals("flower2021"); // ‚≠ê position petals precisely
}

function openChristmas(){
  hideAll();

  document.body.classList.add("christmas-bg");
  document.getElementById("christmasCardPage").style.display="block";

  xmasAudio.play();
  startSnow();
}

function logout(){
  sessionStorage.clear();
  localStorage.clear();
  window.location.replace("login.html");
}

/* =====================================================
   STOP EVERYTHING WHEN LEAVING PAGE  ‚≠ê
===================================================== */

function stopEffects(){

  confetti.innerHTML="";
  confetti.style.display="none";

  /* snow */
  if(snowInterval){
    clearInterval(snowInterval);
    snowInterval = null;
  }
  snow.innerHTML="";
  snow.style.display="none";

  /* audio */
  bdayAudio.pause();
  xmasAudio.pause();
  bdayAudio.currentTime=0;
  xmasAudio.currentTime=0;

}

/* =====================================================
   BALLOONS (same as your 2023 main)
===================================================== */

function startConfetti(){
  confetti.style.display="block";
  setInterval(()=>{
    const c=document.createElement("div");
    c.style.position="absolute";
    c.style.width="8px"; c.style.height="8px";
    c.style.background=`hsl(${Math.random()*360},80%,60%)`;
    c.style.left=Math.random()*100+"vw";
    c.style.animation="fallConfetti 3s linear forwards";
    confetti.appendChild(c);
    setTimeout(()=>c.remove(),3000);
  },60);
}


/* =====================================================
   SNOW (same as your Christmas)
===================================================== */

function startSnow(){

  snow.style.display="block";

  snowInterval=setInterval(()=>{

    const s=document.createElement("div");
    s.innerHTML="‚ùÑ";
    s.style.position="absolute";
    s.style.left=Math.random()*100+"vw";
    s.style.animation="fallSnow 5s linear forwards";

    snow.appendChild(s);

    setTimeout(()=>s.remove(),5000);

  },150);
}


/* ===============================
   Universal Swipeable Photo Viewer
   (petals + 2022 cards + christmas)
================================= */

const modal = document.getElementById("photoModal");
const preview = document.getElementById("photoPreview");
const closeBtn = document.querySelector(".photo-close");
const nextBtn = document.querySelector(".next");
const prevBtn = document.querySelector(".prev");

let currentIndex = 0;
let galleryImages = [];

/* setup gallery from selector */
function setupGallery(selector){
  galleryImages = Array.from(document.querySelectorAll(selector));
}

/* show image */
function showImage(index){
  if(index < 0) index = galleryImages.length - 1;
  if(index >= galleryImages.length) index = 0;

  currentIndex = index;

  preview.style.opacity = 0;

  setTimeout(()=>{
    preview.src = galleryImages[currentIndex].src;
    preview.style.opacity = 1;
  },120);
}



/* ========= CLICK HANDLER ========= */

document.addEventListener("click", function(e){

  /* ===== Flower gallery (multiple images) ===== */
  if(e.target.classList.contains("flower-petal")){
    setupGallery("#flower2021 .flower-petal");

    currentIndex = galleryImages.indexOf(e.target);

    setNavVisible(true);
    showImage(currentIndex);

    modal.style.display = "flex";
    return;
  }

  /* ===== Single christmas image ===== */
  if(e.target.classList.contains("xmas-clickable")){
    setNavVisible(false);

    preview.src = e.target.src;

    modal.style.display = "flex";
    return;
  }

});


/* arrows */
nextBtn.onclick = () => showImage(currentIndex + 1);
prevBtn.onclick = () => showImage(currentIndex - 1);

/* close */
closeBtn.onclick = () => modal.style.display = "none";
modal.onclick = (e)=>{ if(e.target === modal) modal.style.display="none"; };

/* keyboard */
document.addEventListener("keydown", (e)=>{
  if(modal.style.display !== "flex") return;

  if(e.key === "ArrowRight") showImage(currentIndex + 1);
  if(e.key === "ArrowLeft") showImage(currentIndex - 1);
  if(e.key === "Escape") modal.style.display = "none";
});

/* swipe */
let startX = 0;

preview.addEventListener("touchstart", e=>{
  startX = e.touches[0].clientX;
});

preview.addEventListener("touchend", e=>{
  let endX = e.changedTouches[0].clientX;
  let diff = startX - endX;

  if(Math.abs(diff) > 50){
    if(diff > 0) showImage(currentIndex + 1);
    else showImage(currentIndex - 1);
  }
});

/* show/hide arrows */
function setNavVisible(show){
  nextBtn.style.display = show ? "block" : "none";
  prevBtn.style.display = show ? "block" : "none";
}

window.addEventListener("resize", ()=>positionPetals("flower2021"));
window.addEventListener("orientationchange", ()=>positionPetals("flower2021"));

</script>
</body>
</html>
