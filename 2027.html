<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>2027 Memories</title>
<link rel="stylesheet" href="styles.css">

<style>
/* ================= GLOBAL & MOBILE BASICS ================= */
@media (max-width: 768px) {
  body { font-size: 14px; }
  h1 { font-size: 1.5rem; }
  .tiles { flex-direction: column; gap: 10px; }
  .tile { padding: 12px 8px; font-size: 1.2rem; }
  .back-btn, .logout-btn { font-size: 1rem; padding: 8px 12px; }
}

.photo-modal img#photoViewer {
  max-width: 95vw;
  max-height: 90vh;
  object-fit: contain;
}

/* ================= KINETIC GALLERY ‚Äî DESKTOP ================= */
.kinetic-gallery {
  position: relative;
  width: 100%;
  height: 80vh;
  display: flex;
  justify-content: center;
  align-items: center;
  perspective: 2000px;
}

.kinetic-anchor {
  position: absolute;
  width: 300px;
  aspect-ratio: 1429/2000;
  transform-style: preserve-3d;
  transform: translate3d(var(--tx), 0, var(--tz)) rotateY(var(--ry));
  animation: drift 5s ease-in-out infinite alternate;
  z-index: var(--zi);
}

.kinetic-anchor:nth-child(1) { --tx: -220px; --tz: -150px; --ry: 25deg;  --zi: 1; animation-delay: 0s; }
.kinetic-anchor:nth-child(2) { --tx: 0px;    --tz: 0px;    --ry: 0deg;   --zi: 2; animation-delay: -1.5s; }
.kinetic-anchor:nth-child(3) { --tx: 220px;  --tz: -150px; --ry: -25deg; --zi: 1; animation-delay: -3s; }

.kinetic-card {
  width: 100%; height: 100%;
  background-size: cover; background-position: center;
  border-radius: 15px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.6);
  transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
  cursor: pointer;
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.kinetic-anchor:hover .kinetic-card {
  transform: translate3d(0, 0, 300px) rotateY(calc(var(--ry) * -1));
}

/* ================= MOBILE SNAP & OVERLAP ‚Äî FINAL CENTERING ================= */
@media (max-width: 900px) {
  #cardPage {
    display: flex;
    flex-direction: column;
    height: 100dvh;
    width: 100vw;
    overflow: hidden;
  }

  .kinetic-gallery {
    flex: 1;
    display: flex;
    align-items: center;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-padding: 0 50%; 
    gap: 0;
    padding: 0;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
  }
  .kinetic-gallery::-webkit-scrollbar { display: none; }

  .kinetic-anchor {
    position: relative;
    flex: 0 0 260px; /* Card width */
    margin: 0 -40px; /* Overlap: 40px left, 40px right */
    transform: none !important;
    animation: none !important;
    scroll-snap-align: center;
    z-index: 1;
  }

  /* FIX: The first card needs the spacer PLUS the overlap amount to not be cut off */
  .kinetic-anchor:first-child {
    margin-left: calc(50vw - 130px + 450px) !important;
  }

  /* FIX: The last card needs the spacer PLUS the overlap amount to reach center */
  .kinetic-anchor:last-child {
    margin-right: calc(50vw - 130px + 40px) !important;
  }

  .kinetic-anchor:active { z-index: 10; }

  /* LANDSCAPE FIX */
  @media (orientation: landscape) {
    #cardPage { min-height: 420px; }
    .kinetic-anchor { 
      flex: 0 0 200px; 
      margin: 0 -30px; 
    }
    .kinetic-anchor:first-child { margin-left: calc(50vw - 100px + 30px) !important; }
    .kinetic-anchor:last-child { margin-right: calc(50vw - 100px + 30px) !important; }
  }
}

@keyframes drift {
  from { margin-top: -20px; }
  to { margin-top: 20px; }
}
</style>
</head>
<body>

<audio id="birthdayAudio" src="Images/birthday.mp3" loop></audio>
<audio id="christmasAudio" src="Images/christmas.mp3" loop></audio>

<div id="snow" class="effect-layer"></div>
<div id="fireworks" class="effect-layer"></div>

<div class="card page" id="home" style="display:block;">
  <h1>2027</h1>
  <div class="tiles">
    <div class="tile" onclick="openBirthday()">üéÇ Birthday</div>
    <div class="tile" onclick="openChristmas()">üéÑ Christmas</div>
  </div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="card page" id="cardPage" style="display:none;">
    <div class="card-header">
        <h1>2027 Birthday üéÇ</h1>
        <button class="back-btn" onclick="goHome()">Back</button>
    </div>
    <div class="kinetic-gallery" id="birthdayGallery"></div>
</div>

<div class="card page" id="christmasCardPage" style="display:none;">
  <div class="card-header">
    <h1>2027 Christmas üíå</h1>
    <button class="back-btn" onclick="goHome()">Back</button>
  </div>
</div>

<div class="photo-modal" id="photoModal" style="display:none;">
  <span class="photo-close" onclick="closePhoto()">‚úï</span>
  <button class="nav prev" onclick="prevPhoto()">‚ùÆ</button>
  <img id="photoViewer">
  <button class="nav next" onclick="nextPhoto()">‚ùØ</button>
</div>

<script>
const bdayImages = [
  'Images/Birthday_2024_1.png', 
  'Images/Birthday_2024_2.png', 
  'Images/Birthday_2024_3.png'
];

let photos = [];
let photoIndex = 0;
const photoModal = document.getElementById("photoModal");
const photoViewer = document.getElementById("photoViewer");

function hideAll(){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  stopEffects();
}

function goHome(){
  hideAll();
  document.body.classList.remove("birthday-bg", "christmas-bg");
  document.getElementById("home").style.display="block";
}

function openBirthday(){
  hideAll();
  document.body.classList.add("birthday-bg");
  document.getElementById("cardPage").style.display="block";
  initKineticGallery();
  document.getElementById("birthdayAudio").play();
}

function initKineticGallery() {
  const container = document.getElementById("birthdayGallery");
  container.innerHTML = ""; 
  photos = bdayImages.map(src => ({ src: src }));

  bdayImages.forEach((src, idx) => {
    const anchor = document.createElement("div");
    anchor.className = "kinetic-anchor";
    
    const card = document.createElement("div");
    card.className = "kinetic-card";
    card.style.backgroundImage = `url('${src}')`; // Ensure single quotes around path
    
    card.onclick = () => {
        photoIndex = idx;
        showPhoto(photoIndex);
        photoModal.style.display = "flex";
    };

    anchor.appendChild(card);
    container.appendChild(anchor);
  });

  // --- ADD THIS STARTUP CENTERING LOGIC ---
  if (window.innerWidth <= 900) {
    setTimeout(() => {
      const cards = container.querySelectorAll('.kinetic-anchor');
      // Index 1 is the 2nd card
      if (cards[1]) {
        cards[1].scrollIntoView({
          behavior: 'auto', // 'auto' for instant jump on load, 'smooth' for animation
          inline: 'center',
          block: 'nearest'
        });
      }
    }, 100); // Small delay to ensure CSS styles are applied first
  }
}

function showPhoto(i) {
  photoViewer.src = photos[i].src;
}
function closePhoto(){ photoModal.style.display = "none"; }
function nextPhoto(){ photoIndex = (photoIndex + 1) % photos.length; showPhoto(photoIndex); }
function prevPhoto(){ photoIndex = (photoIndex - 1 + photos.length) % photos.length; showPhoto(photoIndex); }

function stopEffects(){
  const bAudio = document.getElementById("birthdayAudio");
  const cAudio = document.getElementById("christmasAudio");
  bAudio.pause(); cAudio.pause();
  bAudio.currentTime = 0; cAudio.currentTime = 0;
}

function logout(){ window.location.replace("login.html"); }
</script>
</body>
</html>